<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<style>
    .battle {
        position: relative;
        width: 100%;
        height: 400px;
        overflow: hidden;
        background-color: yellowgreen;
    }

    .castle {
        position: absolute;
        bottom: 0;
        height: 150px;
    }

    .my-castle { left: 0; }
    .enemy-castle { right: 0; }

    /* â† satera ã‚’è¿½åŠ ã—ãŸï¼ */
    .nyanko, .kyonsi, .enemy, .kai, .satera {
        position: absolute;
        bottom: 0;
        height: 40px;
    }

    .castle-hp {
        position: absolute;
        top: 10px;
        left: 10px;
        color: black;
        font-size: 20px;
    }

    .money-bar {
        position: absolute;
        top: 10px;
        right: 10px;
        background: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 20px;
    }

    #spawn-neko { position:absolute; bottom:10px; left:10px; }
    #spawn-masai { position:absolute; bottom:10px; left:180px; }
    #spawn-kai { position:absolute; bottom:10px; left:350px; }
    #spawn-satera { position:absolute; bottom:10px; left:520px; }
</style>
</head>
<body>

<div class="battle">

    <div class="castle-hp">
        å‘³æ–¹åŸHP: <span id="my-castle-hp">1000</span><br>
        æ•µåŸHP: <span id="enemy-castle-hp">1000</span>
    </div>

    <div class="money-bar">
        ãŠé‡‘: <span id="money-value">150</span>
    </div>

    <img src="./my_castle.png" class="castle my-castle">
    <img src="./enemy_castle.png" class="castle enemy-castle">

    <button id="spawn-kai">å¬ã—è±šã®ã‚«ã‚¤(750å††)</button>
    <button id="spawn-neko">ã«ã‚ƒã‚“ã“å‡ºæ’ƒï¼ˆ30å††ï¼‰</button>
    <button id="spawn-masai">ãƒã‚³ã‚­ãƒ§ãƒ³ã‚·ãƒ¼å‡ºæ’ƒï¼ˆ75å††ï¼‰</button>
    <button id="spawn-satera">ãƒã‚³ã‚µãƒ†ãƒ©ã‚¤ãƒˆå‡ºæ’ƒ(135å††)</button>

</div>

<script>
/* -------------------------
   ãŠé‡‘
-------------------------- */
let money = 300;
const moneyText = document.getElementById("money-value");

setInterval(() => {
    money += 3;
    moneyText.textContent = money;
}, 40);

/* -------------------------
   åŸHP
-------------------------- */
let myCastleHP = 1000;
let enemyCastleHP = 1000;

const myCastleHPText = document.getElementById("my-castle-hp");
const enemyCastleHPText = document.getElementById("enemy-castle-hp");

/* -------------------------
   ãƒœã‚¿ãƒ³
-------------------------- */
const battle = document.querySelector(".battle");
const spawnNekoBtn = document.getElementById("spawn-neko");
const spawnKyonBtn = document.getElementById("spawn-masai");
const spawnKaiBtn = document.getElementById("spawn-kai");
const spawnSateraBtn = document.getElementById("spawn-satera");  // â† è¿½åŠ ï¼

spawnNekoBtn.addEventListener("click", spawnNeko);
spawnKyonBtn.addEventListener("click", spawnKyonsi);
spawnKaiBtn.addEventListener("click", spawnKai);
spawnSateraBtn.addEventListener("click", spawnSatera);           // â† è¿½åŠ ï¼

/* -------------------------
   å‘³æ–¹ç”Ÿæˆ
-------------------------- */
function createAlly(imgSrc, cssClass, hp, speed){
    const unit = document.createElement("img");
    unit.src = imgSrc;
    unit.classList.add(cssClass);
    unit.style.left = "50px";
    unit.hp = hp;

    battle.appendChild(unit);

    let pos = 50;

    const walk = setInterval(() => {
        pos += speed;
        unit.style.left = pos + "px";

        const enemies = document.querySelectorAll(".enemy");
        enemies.forEach(enemy => {
            const ux = unit.getBoundingClientRect().left;
            const ex = enemy.getBoundingClientRect().left;

            if(Math.abs(ux - ex) < 50){
                clearInterval(walk);
                clearInterval(enemy.walkInterval);
                battleFight(unit, enemy);
            }
        });

        if(pos > window.innerWidth - 200){
            clearInterval(walk);
            attackCastle("enemy");
            unit.remove();
        }
    }, 30);

    unit.walkInterval = walk;
}

/* -------------------------
   å‡ºæ’ƒé–¢æ•°
-------------------------- */
function spawnNeko(){
    const cost = 30;
    if(money < cost) return alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ï¼");
    money -= cost;
    moneyText.textContent = money;
    createAlly("./neko.png", "nyanko", 100, 2);
}

function spawnKyonsi(){
    const cost = 75;
    if(money < cost) return alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ï¼");
    money -= cost;
    moneyText.textContent = money;
    createAlly("./kyonsi.png", "kyonsi", 300, 1.2);
}

function spawnKai(){
    const cost = 750;
    if(money < cost) return alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ï¼");
    money -= cost;
    moneyText.textContent = money;
    createAlly("./mesikai.png", "kai", 500, 1.5);
}

function spawnSatera(){
    const cost = 135;
    if(money < cost) return alert("ãŠé‡‘ãŒè¶³ã‚Šãªã„ï¼");
    money -= cost;
    moneyText.textContent = money;
    createAlly("./satera.png", "satera", 200, 3);
}

/* -------------------------
   æ•µ
-------------------------- */
function spawnEnemy(){
    const enemyTypes = [
        { src: "./wanko.png", hp: 80 },
        { src: "./hebi.png", hp: 120 },
        { src: "./me-.png", hp: 150 }
    ];

    const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];

    const enemy = document.createElement("img");
    enemy.src = type.src;
    enemy.classList.add("enemy");
    enemy.style.right = "50px";
    enemy.hp = type.hp;

    battle.appendChild(enemy);

    let pos = 50;

    const walk = setInterval(() => {
        pos += 2;
        enemy.style.right = pos + "px";

        const allies = document.querySelectorAll(".nyanko, .kyonsi, .kai, .satera");
        allies.forEach(ally => {
            const ax = ally.getBoundingClientRect().left;
            const ex = enemy.getBoundingClientRect().left;

            if(Math.abs(ax - ex) < 50){
                clearInterval(walk);
                clearInterval(ally.walkInterval);
                battleFight(ally, enemy);
            }
        });

        if(pos > window.innerWidth - 200){
            clearInterval(walk);
            attackCastle("my");
            enemy.remove();
        }
    }, 30);

    enemy.walkInterval = walk;
}

setInterval(spawnEnemy, 2000);

/* -------------------------
   æˆ¦é—˜
-------------------------- */
function battleFight(ally, enemy){
    const fight = setInterval(() => {
        let allyAtk = 19;
        if(ally.classList.contains("kyonsi")) allyAtk = 40;
        if(ally.classList.contains("kai")) allyAtk = 100;

        let enemyAtk = 10;

        ally.hp -= enemyAtk;
        enemy.hp -= allyAtk;

        if(ally.hp <= 0){
            ally.remove();
            clearInterval(fight);
        }

        if(enemy.hp <= 0){
            enemy.remove();
            clearInterval(fight);
        }
    }, 250);
}

/* -------------------------
   åŸæ”»æ’ƒ
-------------------------- */
function attackCastle(target){
    if(target === "enemy"){
        enemyCastleHP -= 100;
        enemyCastleHPText.textContent = enemyCastleHP;
        if(enemyCastleHP <= 0) alert("ğŸ‰ å®Œå…¨å‹åˆ©ï¼");
    } else {
        myCastleHP -= 100;
        myCastleHPText.textContent = myCastleHP;
        if(myCastleHP <= 0) alert("ğŸ˜µ æ•—åŒ—â€¦");
    }
}
</script>

</body>
</html>
